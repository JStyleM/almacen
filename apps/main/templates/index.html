<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Almacen ICPNA</title>

    {% load static from staticfiles %}

    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'font-awesome/css/font-awesome.css' %}" rel="stylesheet">

    <link href="{% static 'css/plugins/dataTables/datatables.min.css' %}" rel="stylesheet">

    <link href="{% static 'css/animate.css' %}" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/alertify.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/themes/default.min.css' %}" rel="stylesheet">

</head>

<body>

    <div class="ibox-content">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover dataTables-example" id="table_items">
                <thead>
                    <th>Nombre</th>
                    <th>Cantidad</th>
                    <th>Denominacion</th>
                    <th>Almacen</th>
                    <th>Acciones</th>
                </thead>
                <tbody>
                    {% for item in query %}
                    <tr class="gradeX">
                    <td>{{ item.nombre }}</td>
                    <td>{{ item.cantidad }}</td>
                    <td>{{ item.denominacion }}</td>
                    <td>{{ item.almacen }}</td>
                    <td>
                        <button onclick="retirar({{ item.id }})" class="btn btn-info" id="retirar">Retirar</button>
                        <button onclick="editar()" class="btn btn-warning" id="editar">Editar</button>
                        <button onclick="eliminar()"class="btn btn-danger" id="eliminar">Eliminar</button>
                    </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>                
        </div>
    </div>

    <!--scripts -->
    <script src="{% static 'js/jquery-3.1.1.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/plugins/metisMenu/jquery.metisMenu.js' %}"></script>
    <script src="{% static 'js/plugins/slimscroll/jquery.slimscroll.min.js' %}"></script>
    <script src="{% static 'js/alertify.min.js' %}"></script>
    <script src="{% static 'js/plugins/dataTables/datatables.min.js' %}"></script>

    <!-- Custom and plugin javascript -->
    <script src="{% static 'js/inspinia.js' %}"></script>
    <script src="{% static 'js/plugins/pace/pace.min.js' %}"></script>

    <!-- Page-Level Scripts -->
    <script>
        $(document).ready(function(){
            $('.dataTables-example').DataTable({
                pageLength: 25,
                responsive: true,
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    {extend: 'copy'},
                    {extend: 'csv'},
                    {extend: 'excel', title: 'Reporte Almacen'},
                    {extend: 'pdf', title: 'Reporte Almacen'},

                    {extend: 'print',
                     customize: function (win){
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                    }
                    }
                ]

            });

        });

    </script>

    <script>

        function retirar(item_id) {

            alertify.prompt('Almacen ICPNA', 'Ingrese Monto a Retirar', '0', 
                function(evt, value) { 

                    var monto = value;
                    console.log(monto);
                    console.log(item_id);

                    if(monto > 100){

                        alertify.alert('Almacenes ICPNA', 'El monto ingresado es Incorrecto!', function(){});
                        alertify.error('Operacion Cancelada!');
                        }

                    else{

                            alertify.confirm('Almacenes ICPNA','Seguro que deseas Retirar : <b>' + monto + '</b>', 
                                function(){ 

                                    location.hrfe = "{% url 'main:retiro' item_id='item_id' monto='monto' %}";

/*                                    $(document).ready(function() {
                                        var refreshId =  setInterval( function(){
                                            $('#table_items').load("{% url 'main:home' %}");//actualizar tabla
                                        }, 1000 );
                                    });*/

                                    alertify.success('Retiraste: ' + value); 

                                }, function(){ alertify.error('Operacion Cancelada!')});
                        }

                }, function() { alertify.error('Operacion Cancelada!') }).set('type', 'number');


           /* 

            console.log(monto);*/

        }

    </script>

</body>
</html>
